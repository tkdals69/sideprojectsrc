# 환경변수 매핑

## Docker Compose → Kubernetes 전환 매핑

### 공통 환경변수

| 환경변수 | Docker Compose | Kubernetes | 리소스 타입 | 비고 |
|---------|---------------|------------|------------|------|
| `DB_HOST` | `postgres` | `postgres-service` | ConfigMap | 호스트명 변경 |
| `DB_PORT` | `5432` | `5432` | ConfigMap | - |
| `DB_USER` | `postgres` | `postgres` | ConfigMap | - |
| `DB_PASSWORD` | `password` | `<강력한 비밀번호>` | **Secret** | 🔒 |
| `DB_NAME` | `mini_commerce` | `mini_commerce` | ConfigMap | - |
| `DATABASE_URL` | `postgresql://postgres:password@postgres:5432/mini_commerce` | `postgresql://postgres:<password>@postgres-service:5432/mini_commerce` | **Secret** | 🔒 호스트명 변경 |
| `NODE_ENV` | `development` | `production` | ConfigMap | 환경 변경 |
| `LOG_LEVEL` | `debug` | `info` | ConfigMap | 환경 변경 |

---

## 서비스별 환경변수

### Auth Service

| 환경변수 | 값 | 리소스 타입 |
|---------|---|------------|
| `PORT` | `3001` | ConfigMap |
| `JWT_SECRET` | `<openssl rand -base64 32>` | **Secret** 🔒 |
| `JWT_EXPIRES_IN` | `24h` | ConfigMap |

**+ 공통 DB 환경변수**

---

### Catalog Service

| 환경변수 | 값 | 리소스 타입 |
|---------|---|------------|
| `PORT` | `8080` | ConfigMap |

**+ 공통 DB 환경변수**

---

### Cart Service

| 환경변수 | 값 | 리소스 타입 |
|---------|---|------------|
| `PORT` | `3003` | ConfigMap |

**+ 공통 DB 환경변수**

---

### Order Service (Spring Boot)

| 환경변수 | 값 | 리소스 타입 | 비고 |
|---------|---|------------|------|
| `PORT` | `8080` | ConfigMap | |
| `SPRING_DATASOURCE_URL` | `jdbc:postgresql://postgres-service:5432/mini_commerce` | ConfigMap | 호스트명 변경 |
| `SPRING_DATASOURCE_USERNAME` | `postgres` | ConfigMap | |
| `SPRING_DATASOURCE_PASSWORD` | `<강력한 비밀번호>` | **Secret** 🔒 | |
| `SPRING_PROFILES_ACTIVE` | `production` | ConfigMap | 신규 추가 |

---

### Inventory Service

| 환경변수 | 값 | 리소스 타입 |
|---------|---|------------|
| `PORT` | `3005` | ConfigMap |

**+ 공통 DB 환경변수**

---

### Payment Service

| 환경변수 | Docker Compose | Kubernetes | 리소스 타입 |
|---------|---------------|------------|------------|
| `NODE_ENV` | `production` | `production` | ConfigMap |
| `PORT` | `3005` | `3005` | ConfigMap |
| `ORDER_SERVICE_URL` | `http://mini-commerce-order:8080` | `http://order-service:8080` | ConfigMap |
| `CART_SERVICE_URL` | `http://mini-commerce-cart:3003` | `http://cart-service:3003` | ConfigMap |
| `NOTIFICATION_SERVICE_URL` | `http://mini-commerce-notification:3007` | `http://notification-service:3007` | ConfigMap |

---

### Notification Service

| 환경변수 | 값 | 리소스 타입 |
|---------|---|------------|
| `PORT` | `3007` | ConfigMap |

**+ 공통 DB 환경변수**

---

## ConfigMap 구조

```
common-config          # DB 연결 정보, 환경 설정
auth-config           # PORT, JWT_EXPIRES_IN
catalog-config        # PORT
cart-config           # PORT
order-config          # PORT, SPRING_* 설정
inventory-config      # PORT
payment-config        # PORT, 서비스 URL들
notification-config   # PORT
```

---

## Secret 구조

```
postgres-secret           # DB_PASSWORD, SPRING_DATASOURCE_PASSWORD
auth-secret              # JWT_SECRET
database-url-secret      # DATABASE_URL (비밀번호 포함)
```

---

## 주요 변경사항

### 1. 서비스 호스트명 변경
- `postgres` → `postgres-service`
- `mini-commerce-*` → `*-service`

### 2. 서비스 URL 변경
| Before | After |
|--------|-------|
| `http://mini-commerce-order:8080` | `http://order-service:8080` |
| `http://mini-commerce-cart:3003` | `http://cart-service:3003` |
| `http://mini-commerce-notification:3007` | `http://notification-service:3007` |

### 3. 포트
- Docker Compose: 외부:내부 매핑 (예: `3002:8080`)
- Kubernetes: Container는 내부 포트만, Service가 매핑 담당

### 4. Secret 생성 명령어

```bash
# JWT Secret 생성
openssl rand -base64 32

# DB Password 생성
openssl rand -base64 24
```

---

## 보안 체크리스트

- [ ] JWT_SECRET을 강력한 키로 변경
- [ ] DB_PASSWORD를 강력한 비밀번호로 변경
- [ ] Secret YAML을 .gitignore에 추가
- [ ] Sealed Secrets 또는 External Secrets 사용 고려

